import{k as B,r as v,l as F,Y as O,ag as g,o as m,c as b,a as o,Q as a,I as s,M as x,n as z,H as y,L as p,W as H,O as Q}from"./@vue-330d97db.js";import{u as W,b as Y}from"./vue-router-058388f3.js";import{m as A}from"./js-md5-9462b393.js";import{_ as G}from"./index-b9f773a6.js";import"./APlayer-9761ea46.js";import"./element-plus-d7f7ad33.js";import"./lodash-es-32f1e46b.js";import"./@vueuse-df397a67.js";import"./@element-plus-4e918346.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-d2501332.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-5ec34e26.js";import"./vue-cookies-fe30a31f.js";import"./@highlightjs-189340a0.js";import"./highlight.js-f4cd52b3.js";import"./axios-439bb627.js";import"./docx-preview-01ead95e.js";import"./jszip-34d9bb61.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-1732b75d.js";import"./vue-2734522e.js";import"./dplayer-c9b96a6f.js";import"./vue-clipboard3-81308b3a.js";import"./clipboard-11dc70c3.js";const J={class:"login-body"},K={class:"login-panel"},X={key:1},Z={class:"send-emali-panel"},ee={class:"check-code-panel"},oe=["src"],se={class:"rememberme-panel"},le={class:"no-account"},te={key:0},ae={key:1},re={key:2},ie={class:"check-code-panel"},ne=["src"],de={__name:"Login",setup(ue){const{proxy:u}=B(),D=W(),L=Y(),k={checkCode:"/api/checkCode",sendMailCode:"/sendEmailCode",register:"/register",login:"/login",resetPwd:"/resetPwd"},r=v(1),c=i=>{r.value=i,j()};F(()=>{c(1)});const N=(i,e,n)=>{e!==t.value.registerPassword?n(new Error(i.message)):n()},t=v({}),M=v(),R={email:[{required:!0,message:"请输入邮箱"},{validator:u.Verify.email,message:"请输入正确的邮箱"}],password:[{required:!0,message:"请输入密码"}],emailCode:[{required:!0,message:"请输入邮箱验证码"}],nickName:[{required:!0,message:"请输入昵称"}],registerPassword:[{required:!0,message:"请输入密码"},{validator:u.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],reRegisterPassword:[{required:!0,message:"请再次输入密码"},{validator:N,message:"两次输入的密码不一致"}],checkCode:[{required:!0,message:"请输入图片验证码"}]},U=v(),h=v(),w=i=>{i==0?U.value=k.checkCode+"?type="+i+"&time="+new Date().getTime():h.value=k.checkCode+"?type="+i+"&time="+new Date().getTime()},V=v({}),P=v(),C=O({show:!1,title:"发送邮箱验证码",buttons:[{type:"primary",text:"发送验证码",click:()=>{$()}}]}),S=()=>{M.value.validateField("email",i=>{i&&(C.show=!0,z(()=>{w(1),P.value.resetFields(),V.value={email:t.value.email}}))})},$=()=>{P.value.validate(async i=>{if(!i)return;const e=Object.assign({},V.value);e.type=r.value==0?0:1,await u.Request({url:k.sendMailCode,params:e,errorCallback:()=>{w(1)}})&&(u.Message.success("验证码发送成功，请登录邮箱查看"),C.show=!1)})},j=()=>{z(()=>{if(w(0),M.value.resetFields(),r.value==1){const i=u.VueCookies.get("loginInfo");i&&(t.value=i)}})},q=()=>{M.value.validate(async i=>{if(!i)return;let e={};if(Object.assign(e,t.value),(r.value==0||r.value==2)&&(e.password=e.registerPassword,delete e.registerPassword,delete e.reRegisterPassword),r.value==1){let f=u.VueCookies.get("loginInfo"),_=f==null?null:f.password;e.password!==_&&(e.password=A(e.password))}let n=null;r.value==0?n=k.register:r.value==1?n=k.login:r.value==2&&(n=k.resetPwd);let d=await u.Request({url:n,params:e,errorCallback:()=>{t.value.checkCode="",w(0)}});if(d)if(r.value==0)u.Message.success("注册成功,请登录"),c(1);else if(r.value==1){if(e.rememberMe){const _={email:e.email,password:e.password,rememberMe:e.rememberMe};u.VueCookies.set("loginInfo",_,"7d")}else u.VueCookies.remove("loginInfo");u.Message.success("登录成功"),u.VueCookies.set("userInfo",d.data,0);const f=L.query.redirectUrl||"/";D.push(f)}else r.value==2&&(u.Message.success("重置密码成功,请登录"),c(1))})};return(i,e)=>{const n=g("el-input"),d=g("el-form-item"),f=g("el-button"),_=g("el-popover"),E=g("el-checkbox"),I=g("el-form"),T=g("Dialog");return m(),b("div",J,[e[30]||(e[30]=o("div",{class:"bg"},null,-1)),o("div",K,[a(I,{class:"login-register",model:t.value,rules:R,ref_key:"formDataRef",ref:M},{default:s(()=>[e[28]||(e[28]=o("div",{class:"login-title"},"Echo个人文件存储系统",-1)),a(d,{prop:"email"},{default:s(()=>[a(n,{size:"large",clearable:"",placeholder:"请输入邮箱",modelValue:t.value.email,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.email=l),modelModifiers:{trim:!0},maxLength:"150"},{prefix:s(()=>e[17]||(e[17]=[o("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1}),r.value==1?(m(),y(d,{key:0,prop:"password"},{default:s(()=>[a(n,{type:"password",size:"large",placeholder:"请输入密码",modelValue:t.value.password,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.password=l),modelModifiers:{trim:!0},"show-password":""},{prefix:s(()=>e[18]||(e[18]=[o("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})):p("",!0),r.value==0||r.value==2?(m(),b("div",X,[a(d,{prop:"emailCode"},{default:s(()=>[o("div",Z,[a(n,{size:"large",placeholder:"请输入邮箱验证码",modelValue:t.value.emailCode,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.emailCode=l),modelModifiers:{trim:!0}},{prefix:s(()=>e[19]||(e[19]=[o("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),a(f,{class:"send-mail-btn",type:"primary",size:"large",onClick:S},{default:s(()=>e[20]||(e[20]=[x("获取验证码")])),_:1})]),a(_,{placement:"left",width:500,trigger:"click"},{reference:s(()=>e[21]||(e[21]=[o("span",{class:"a-link",style:{"font-size":"14px"}},"未收到邮箱验证码？",-1)])),default:s(()=>[e[22]||(e[22]=o("div",null,[o("p",null,"1、在垃圾箱中查找邮箱验证码"),o("p",null,"2、在邮箱中头像->设置->反垃圾->白名单->设置邮件地址白名单"),o("p",null," 3、将邮箱【2483401419@qq.com】添加到白名单 ")],-1))]),_:1})]),_:1}),r.value==0?(m(),y(d,{key:0,prop:"nickName"},{default:s(()=>[a(n,{size:"large",clearable:"",placeholder:"请输入昵称",modelValue:t.value.nickName,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.nickName=l),modelModifiers:{trim:!0},maxLength:"20"},{prefix:s(()=>e[23]||(e[23]=[o("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1})):p("",!0),a(d,{prop:"registerPassword"},{default:s(()=>[a(n,{type:"password",size:"large",placeholder:"请输入密码",modelValue:t.value.registerPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.registerPassword=l),modelModifiers:{trim:!0},"show-password":""},{prefix:s(()=>e[24]||(e[24]=[o("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1}),a(d,{prop:"reRegisterPassword"},{default:s(()=>[a(n,{type:"password",size:"large",placeholder:"请再次输入密码",modelValue:t.value.reRegisterPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.reRegisterPassword=l),modelModifiers:{trim:!0},"show-password":""},{prefix:s(()=>e[25]||(e[25]=[o("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})])):p("",!0),a(d,{prop:"checkCode"},{default:s(()=>[o("div",ee,[a(n,{size:"large",placeholder:"请输入验证码",modelValue:t.value.checkCode,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.checkCode=l),modelModifiers:{trim:!0},onClick:q},{prefix:s(()=>e[26]||(e[26]=[o("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),o("img",{src:U.value,class:"check-code",onClick:e[7]||(e[7]=l=>w(0))},null,8,oe)])]),_:1}),r.value==1?(m(),y(d,{key:2},{default:s(()=>[o("div",se,[a(E,{modelValue:t.value.rememberMe,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.rememberMe=l)},{default:s(()=>e[27]||(e[27]=[x("记住我")])),_:1},8,["modelValue"])]),o("div",le,[o("a",{href:"javascript:void(0)",class:"a-link",onClick:e[9]||(e[9]=l=>c(2))},"忘记密码？"),o("a",{href:"javascript:void(0)",class:"a-link",onClick:e[10]||(e[10]=l=>c(0))},"没有账号？")])]),_:1})):p("",!0),r.value==0?(m(),y(d,{key:3},{default:s(()=>[o("a",{href:"javascript:void(0)",class:"a-link",onClick:e[11]||(e[11]=l=>c(1))},"已有账号?")]),_:1})):p("",!0),r.value==2?(m(),y(d,{key:4},{default:s(()=>[o("a",{href:"javascript:void(0)",class:"a-link",onClick:e[12]||(e[12]=l=>c(1))},"去登录?")]),_:1})):p("",!0),a(d,null,{default:s(()=>[a(f,{type:"primary",class:"op-btn",onClick:q,size:"large"},{default:s(()=>[r.value==0?(m(),b("span",te,"注册")):p("",!0),r.value==1?(m(),b("span",ae,"登录")):p("",!0),r.value==2?(m(),b("span",re,"重置密码")):p("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),a(T,{show:C.show,title:C.title,buttons:C.buttons,width:"500px",showCancel:!1,onClose:e[16]||(e[16]=l=>C.show=!1)},{default:s(()=>[a(I,{model:V.value,rules:R,ref_key:"formData4SendMailCodeRef",ref:P,"label-width":"80px",onSubmit:e[15]||(e[15]=H(()=>{},["prevent"]))},{default:s(()=>[a(d,{label:"邮箱"},{default:s(()=>[x(Q(t.value.email),1)]),_:1}),a(d,{label:"验证码",prop:"checkCode"},{default:s(()=>[o("div",ie,[a(n,{size:"large",placeholder:"请输入验证码",modelValue:V.value.checkCode,"onUpdate:modelValue":e[13]||(e[13]=l=>V.value.checkCode=l),modelModifiers:{trim:!0}},{prefix:s(()=>e[29]||(e[29]=[o("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),o("img",{src:h.value,class:"check-code",onClick:e[14]||(e[14]=l=>w(1))},null,8,ne)])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"]),e[31]||(e[31]=o("div",{class:"icp-link"},[o("a",{href:"https://beian.miit.gov.cn/",target:"_blank"},"粤ICP备2024327259号-2"),x(" @2024-2025 www.echopan.cn 版权所有 ")],-1))])}}},Ee=G(de,[["__scopeId","data-v-8316b202"]]);export{Ee as default};
