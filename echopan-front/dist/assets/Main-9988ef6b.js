import{k as ae,r as u,ag as f,o as r,c as p,Q as a,I as s,W as oe,M as m,O as T,P as K,H as M,L as h,n as X,b as ge,a as n,a6 as te,D as we,u as ke}from"./@vue-330d97db.js";import{u as be}from"./vue-clipboard3-81308b3a.js";import{_ as Fe}from"./index-b9f773a6.js";import"./clipboard-11dc70c3.js";import"./APlayer-9761ea46.js";import"./element-plus-d7f7ad33.js";import"./lodash-es-32f1e46b.js";import"./@vueuse-df397a67.js";import"./@element-plus-4e918346.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-d2501332.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-5ec34e26.js";import"./vue-router-058388f3.js";import"./vue-cookies-fe30a31f.js";import"./@highlightjs-189340a0.js";import"./highlight.js-f4cd52b3.js";import"./axios-439bb627.js";import"./docx-preview-01ead95e.js";import"./jszip-34d9bb61.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-1732b75d.js";import"./vue-2734522e.js";import"./dplayer-c9b96a6f.js";const Ce={all:{accept:"*"},video:{accept:".mp4,.avi,.rmvb,.mkv,.mov"},music:{accept:".mp3,.wav,.wma,.mp2,.flac,.midi,.ra,.ape,.aac,.cda"},image:{accept:".jpeg,.jpg,.png,.gif,.bmp,.dds,.psd,.pdt,.webp,.xmp,.svg,.tiff"},doc:{accept:".pdf,.doc,.docx,.xls,.xlsx,.txt"},others:{accept:"*"}},Ne={__name:"ShareFile",setup(se,{expose:A}){const{toClipboard:H}=be(),{proxy:c}=ae(),E=u(document.location.origin+"/share/"),O={shareFile:"/share/shareFile"},z=u(0),d=u({}),v=u(),P={validType:[{required:!0,message:"请选择有效期"}],codeType:[{required:!0,message:"请选择提取码类型"}],code:[{required:!0,message:"请输入提取码"},{validator:c.Verify.shareCode,message:"提取码只能是数字字母"},{min:5,message:"提取码最少5位"}]},S=u(!0),k=u({show:!1,title:"分享",buttons:[{type:"primary",text:"确定",click:g=>{Q()}}]}),i=u({}),Q=async()=>{if(Object.keys(i.value).length>0){k.value.show=!1;return}v.value.validate(async g=>{if(!g)return;let t={};Object.assign(t,d.value);let _=await c.Request({url:O.shareFile,params:t});_&&(z.value=1,i.value=_.data,k.value.buttons[0].text="关闭",S.value=!1)})};A({show:g=>{S.value=!0,k.value.show=!0,z.value=0,i.value={},X(()=>{v.value.resetFields(),d.value=Object.assign({},g)})}});const x=async()=>{await H(`链接:${E.value}${i.value.shareId} 提取码: ${i.value.code}`),c.Message.success("复制成功")};return(g,t)=>{const _=f("el-form-item"),C=f("el-radio"),b=f("el-radio-group"),V=f("el-input"),L=f("el-button"),W=f("el-form"),U=f("Dialog");return r(),p("div",null,[a(U,{show:k.value.show,title:k.value.title,buttons:k.value.buttons,width:"600px",showCancel:S.value,onClose:t[4]||(t[4]=N=>k.value.show=!1)},{default:s(()=>[a(W,{model:d.value,rules:P,ref_key:"formDataRef",ref:v,"label-width":"100px",onSubmit:t[3]||(t[3]=oe(()=>{},["prevent"]))},{default:s(()=>[a(_,{label:"文件"},{default:s(()=>[m(T(d.value.fileName),1)]),_:1}),z.value==0?(r(),p(K,{key:0},[a(_,{label:"有效期",prop:"validType"},{default:s(()=>[a(b,{modelValue:d.value.validType,"onUpdate:modelValue":t[0]||(t[0]=N=>d.value.validType=N)},{default:s(()=>[a(C,{label:0},{default:s(()=>t[5]||(t[5]=[m("1天")])),_:1}),a(C,{label:1},{default:s(()=>t[6]||(t[6]=[m("7天")])),_:1}),a(C,{label:2},{default:s(()=>t[7]||(t[7]=[m("30天")])),_:1}),a(C,{label:3},{default:s(()=>t[8]||(t[8]=[m("永久有效")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(_,{label:"提取码",prop:"codeType"},{default:s(()=>[a(b,{modelValue:d.value.codeType,"onUpdate:modelValue":t[1]||(t[1]=N=>d.value.codeType=N)},{default:s(()=>[a(C,{label:0},{default:s(()=>t[9]||(t[9]=[m("自定义")])),_:1}),a(C,{label:1},{default:s(()=>t[10]||(t[10]=[m("系统生成")])),_:1})]),_:1},8,["modelValue"])]),_:1}),d.value.codeType==0?(r(),M(_,{key:0,prop:"code"},{default:s(()=>[a(V,{clearable:"",placeholder:"请输入5位提取码",modelValue:d.value.code,"onUpdate:modelValue":t[2]||(t[2]=N=>d.value.code=N),modelModifiers:{trim:!0},maxLength:"5",style:{width:"130px"}},null,8,["modelValue"])]),_:1})):h("",!0)],64)):(r(),p(K,{key:1},[a(_,{label:"分享连接"},{default:s(()=>[m(T(E.value)+T(i.value.shareId),1)]),_:1}),a(_,{label:"提取码"},{default:s(()=>[m(T(i.value.code),1)]),_:1}),a(_,null,{default:s(()=>[a(L,{type:"primary",onClick:x},{default:s(()=>t[11]||(t[11]=[m("复制链接及提取码")])),_:1})]),_:1})],64))]),_:1},8,["model"])]),_:1},8,["show","title","buttons","showCancel"])])}}};const Ie={class:"top"},Te={class:"top-op"},xe={class:"btn"},Re={class:"search-panel"},Se={key:0,class:"file-list"},Ve=["onMouseenter","onMouseleave"],De=["title"],$e=["onClick"],Me={key:0,class:"transfer-status"},Ee={key:1,class:"transfer-status transfer-fail"},Oe={key:3,class:"edit-panel"},ze=["onClick"],Pe=["onClick"],qe={class:"op"},Le=["onClick"],Ue=["onClick"],je=["onClick"],Be=["onClick"],Ke=["onClick"],Ae={key:0},He={key:1,class:"no-data"},Qe={class:"no-data-inner"},We={class:"op-list"},Ge={class:"op-item"},Je={__name:"Main",emits:["addFile"],setup(se,{expose:A,emit:H}){const{proxy:c}=ae(),E=H,O=async l=>{E("addFile",{file:l.file,filePid:d.value.fileId})};A({reload:()=>{x.value=!1,t()}});const d=u({fileId:0}),v={loadDataList:"/file/loadDataList",rename:"/file/rename",newFoloder:"/file/newFoloder",getFolderInfo:"/file/getFolderInfo",delFile:"/file/delFile",changeFileFolder:"/file/changeFileFolder",createDownloadUrl:"/file/createDownloadUrl",download:"/api/file/download"},P=ge(()=>{const l=Ce[g.value];return l?l.accept:"*"}),S=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],k=()=>{x.value=!0,t()},i=u({}),Q={extHeight:50,selectType:"checkbox"},q=u(),x=u(!0),g=u(),t=async()=>{let l={pageNo:i.value.pageNo,pageSize:i.value.pageSize,fileNameFuzzy:q.value,category:g.value,filePid:d.value.fileId};l.category!=="all"&&delete l.filePid;let e=await c.Request({url:v.loadDataList,showLoading:x,params:l});e&&(i.value=e.data,b.value=!1)},_=l=>{i.value.list.forEach(e=>{e.showOp=!1}),l.showOp=!0},C=l=>{l.showOp=!1},b=u(!1),V=u(),L=()=>{b.value||(i.value.list.forEach(l=>{l.showEdit=!1}),b.value=!0,i.value.list.unshift({showEdit:!0,fileType:0,fileId:"",filePid:d.value.fileId}),X(()=>{V.value.focus()}))},W=l=>{const e=i.value.list[l];e.fileId?e.showEdit=!1:i.value.list.splice(l,1),b.value=!1},U=async l=>{const{fileId:e,filePid:w,fileNameReal:R}=i.value.list[l];if(R==""||R.indexOf("/")!=-1){c.Message.warning("文件名不能为空且不能含有斜杠");return}let $=v.rename;e==""&&($=v.newFoloder);let B=await c.Request({url:$,params:{fileId:e,filePid:w,fileName:R}});B&&(i.value.list[l]=B.data,b.value=!1)},N=l=>{i.value.list[0].fileId==""&&(i.value.list.splice(0,1),l=l-1),i.value.list.forEach(w=>{w.showEdit=!1});let e=i.value.list[l];e.showEdit=!0,e.folderType==0?(e.fileNameReal=e.fileName.substring(0,e.fileName.indexOf(".")),e.fileSuffix=e.fileName.substring(e.fileName.indexOf("."))):(e.fileNameReal=e.fileName,e.fileSuffix=""),b.value=!0,X(()=>{V.value.focus()})},I=u([]),Y=u([]),ie=l=>{Y.value=l,I.value=[],l.forEach(e=>{I.value.push(e.fileId)})},ne=l=>{c.Confirm(`你确定要删除【${l.fileName}】吗？删除的文件可在10天内通过回收站还原`,async()=>{await c.Request({url:v.delFile,params:{fileIds:l.fileId}})&&t()})},ue=()=>{I.value.length!=0&&c.Confirm("你确定要删除这些文件吗？删除的文件可在10天内通过回收站还原",async()=>{await c.Request({url:v.delFile,params:{fileIds:I.value.join(",")}})&&t()})},j=u(),D=u({}),re=l=>{D.value=l,j.value.showFolderDialog(l.fileId)},de=()=>{D.value={};const l=[d.value.fileId];Y.value.forEach(e=>{e.folderType==1&&l.push(e.fileId)}),j.value.showFolderDialog(l.join(","))},ce=async l=>{if(D.value.filePid===l||d.value.fileId==l){c.Message.warning("文件正在当前目录，无需移动");return}let e=[];D.value.fileId?e.push(D.value.fileId):e=e.concat(I.value),await c.Request({url:v.changeFileFolder,params:{fileIds:e.join(","),filePid:l}})&&(j.value.close(),t())},Z=u(),ee=u(),fe=l=>{if(l.folderType==1){ee.value.openFolder(l);return}if(l.status!=2){c.Message.warning("文件正在转码中，无法预览");return}Z.value.showPreview(l,0)},pe=l=>{const{curFolder:e,categoryId:w}=l;d.value=e,x.value=!0,g.value=w,t()},me=async l=>{let e=await c.Request({url:v.createDownloadUrl+"/"+l.fileId});e&&(window.location.href=v.download+"/"+e.data)},le=u(),ve=l=>{le.value.show(l)};return(l,e)=>{const w=f("el-button"),R=f("el-upload"),$=f("el-input"),B=f("Navigation"),G=f("icon"),_e=f("Table"),J=f("Icon"),ye=f("Preview"),he=f("FolderSelect");return r(),p("div",null,[n("div",Ie,[n("div",Te,[n("div",xe,[a(R,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":O,accept:P.value},{default:s(()=>[a(w,{type:"primary"},{default:s(()=>e[1]||(e[1]=[n("span",{class:"iconfont icon-upload"},null,-1),m(" 上传 ")])),_:1})]),_:1},8,["accept"])]),g.value=="all"?(r(),M(w,{key:0,type:"success",onClick:L},{default:s(()=>e[2]||(e[2]=[n("span",{class:"iconfont icon-folder-add"},null,-1),m(" 新建文件夹 ")])),_:1})):h("",!0),a(w,{onClick:ue,type:"danger",disabled:I.value.length==0},{default:s(()=>e[3]||(e[3]=[n("span",{class:"iconfont icon-del"},null,-1),m(" 批量删除 ")])),_:1},8,["disabled"]),a(w,{onClick:de,type:"warning",disabled:I.value.length==0},{default:s(()=>e[4]||(e[4]=[n("span",{class:"iconfont icon-move"},null,-1),m(" 批量移动 ")])),_:1},8,["disabled"]),n("div",Re,[a($,{clearable:"",placeholder:"输入文件名搜索",modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=F=>q.value=F),onKeyup:te(k,["enter"])},{suffix:s(()=>[n("i",{class:"iconfont icon-search",onClick:k})]),_:1},8,["modelValue"])]),n("div",{class:"iconfont icon-refresh",onClick:t})]),a(B,{ref_key:"navigationRef",ref:ee,onNavChange:pe},null,512)]),i.value.list&&i.value.list.length>0?(r(),p("div",Se,[a(_e,{ref:"dataTableRef",columns:S,showPagination:!0,dataSource:i.value,fetch:t,initFetch:!1,options:Q,onRowSelected:ie},{fileName:s(({index:F,row:o})=>[n("div",{class:"file-item",onMouseenter:y=>_(o),onMouseleave:y=>C(o)},[(o.fileType==3||o.fileType==1)&&o.status==2?(r(),M(G,{key:0,cover:o.fileCover,width:32},null,8,["cover"])):(r(),p(K,{key:1},[o.folderType==0?(r(),M(G,{key:0,fileType:o.fileType},null,8,["fileType"])):h("",!0),o.folderType==1?(r(),M(G,{key:1,fileType:0})):h("",!0)],64)),o.showEdit?h("",!0):(r(),p("span",{key:2,class:"file-name",title:o.fileName},[n("span",{onClick:y=>fe(o)},T(o.fileName),9,$e),o.status==0?(r(),p("span",Me,"转码中")):h("",!0),o.status==1?(r(),p("span",Ee,"转码失败")):h("",!0)],8,De)),o.showEdit?(r(),p("div",Oe,[a($,{modelValue:o.fileNameReal,"onUpdate:modelValue":y=>o.fileNameReal=y,modelModifiers:{trim:!0},ref_key:"editNameRef",ref:V,maxLength:190,onKeyup:te(y=>U(F),["enter"])},{suffix:s(()=>[m(T(o.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),n("span",{class:we(["iconfont icon-right1",o.fileNameReal?"":"not-allow"]),onClick:y=>U(F)},null,10,ze),n("span",{class:"iconfont icon-error",onClick:y=>W(F)},null,8,Pe)])):h("",!0),n("span",qe,[o.showOp&&o.fileId&&o.status==2?(r(),p(K,{key:0},[n("span",{class:"iconfont icon-share1",onClick:y=>ve(o)},"分享",8,Le),o.folderType==0?(r(),p("span",{key:0,class:"iconfont icon-download",onClick:y=>me(o)},"下载",8,Ue)):h("",!0),n("span",{class:"iconfont icon-del",onClick:y=>ne(o)},"删除",8,je),n("span",{class:"iconfont icon-edit",onClick:oe(y=>N(F),["stop"])},"重命名",8,Be),n("span",{class:"iconfont icon-move",onClick:y=>re(o)},"移动",8,Ke)],64)):h("",!0)])],40,Ve)]),fileSize:s(({row:F})=>[F.fileSize?(r(),p("span",Ae,T(ke(c).Utils.size2Str(F.fileSize)),1)):h("",!0)]),_:1},8,["dataSource"])])):(r(),p("div",He,[n("div",Qe,[a(J,{iconName:"no_data",width:120,fit:"fill"}),e[7]||(e[7]=n("div",{class:"tips"},"当前目录为空，上传你的第一个文件吧",-1)),n("div",We,[a(R,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":O,accept:P.value},{default:s(()=>[n("div",Ge,[a(J,{iconName:"file",width:60}),e[5]||(e[5]=n("div",null,"上传文件",-1))])]),_:1},8,["accept"]),g.value=="all"?(r(),p("div",{key:0,class:"op-item",onClick:L},[a(J,{iconName:"folder",width:60}),e[6]||(e[6]=n("div",null,"新建目录",-1))])):h("",!0)])])])),a(ye,{ref_key:"previewRef",ref:Z},null,512),a(he,{ref_key:"folderSelectRef",ref:j,onFolderSelect:ce},null,512),a(Ne,{ref_key:"shareRef",ref:le},null,512)])}}},Cl=Fe(Je,[["__scopeId","data-v-98c53079"]]);export{Cl as default};
