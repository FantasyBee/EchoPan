import{k as H,r,ag as f,o as s,c as i,a as l,Q as m,I as h,a6 as b,M as z,H as N,P as L,L as n,O as C,D as j,u as Q}from"./@vue-330d97db.js";import{_ as G}from"./index-b9f773a6.js";import"./element-plus-d7f7ad33.js";import"./lodash-es-32f1e46b.js";import"./@vueuse-df397a67.js";import"./@element-plus-4e918346.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-d2501332.js";import"./APlayer-9761ea46.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-5ec34e26.js";import"./vue-router-058388f3.js";import"./vue-cookies-fe30a31f.js";import"./@highlightjs-189340a0.js";import"./highlight.js-f4cd52b3.js";import"./axios-439bb627.js";import"./docx-preview-01ead95e.js";import"./jszip-34d9bb61.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-1732b75d.js";import"./vue-2734522e.js";import"./dplayer-c9b96a6f.js";import"./vue-clipboard3-81308b3a.js";import"./clipboard-11dc70c3.js";const J={class:"top"},W={class:"top-op"},X={class:"search-panel"},Y={class:"file-list"},Z=["onMouseenter","onMouseleave"],ee=["title"],te=["onClick"],oe={key:0,class:"transfer-status"},le={key:1,class:"transfer-status transfer-fail"},se={key:3,class:"edit-panel"},ae=["onClick"],ie=["onClick"],ne={class:"op"},ce=["onClick"],re=["onClick"],de={key:0},pe={__name:"FileList",setup(ue){const{proxy:c}=H(),_={loadDataList:"/admin/loadFileList",delFile:"/admin/delFile",createDownloadUrl:"/admin/createDownloadUrl",download:"/api/admin/download"},R=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"发布人",prop:"nickName",width:250},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],F=()=>{k.value=!0,p()},v=r({}),V={extHeight:50,selectType:"checkbox"},d=r([]),x=t=>{d.value=[],t.forEach(o=>{d.value.push(o.userId+"_"+o.fileId)}),console.log(d)},y=r(),k=r(!0),p=async()=>{let t={pageNo:v.value.pageNo,pageSize:v.value.pageSize,fileNameFuzzy:y.value,filePid:w.value.fileId},o=await c.Request({url:_.loadDataList,showLoading:k,params:t});o&&(v.value=o.data)},U=t=>{v.value.list.forEach(o=>{o.showOp=!1}),t.showOp=!0},D=t=>{t.showOp=!1},S=r(),I=r(),$=t=>{if(t.folderType==1){I.value.openFolder(t);return}if(t.status!=2){c.Message.warning("文件正在转码中，无法预览");return}S.value.showPreview(t,1)},w=r({fileId:0}),E=t=>{const{curFolder:o}=t;w.value=o,k.value=!0,p()},O=t=>{c.Confirm(`你确定要删除【${t.fileName}】吗？删除的文件可在10天内通过回收站还原`,async()=>{await c.Request({url:_.delFile,params:{fileIdAndUserIds:t.userId+"_"+t.fileId}})&&p()})},M=()=>{d.value.length!=0&&c.Confirm("你确定要删除这些文件吗？删除的文件可在10天内通过回收站还原",async()=>{await c.Request({url:_.delFile,params:{fileIdAndUserIds:d.value.join(",")}})&&p()})},P=async t=>{let o=await c.Request({url:_.createDownloadUrl+"/"+t.userId+"/"+t.fileId});o&&(window.location.href=_.download+"/"+o.data)};return(t,o)=>{const T=f("el-input"),B=f("el-button"),q=f("Navigation"),g=f("icon"),K=f("Table"),A=f("Preview");return s(),i("div",null,[l("div",J,[l("div",W,[l("div",X,[m(T,{clearable:"",placeholder:"输入文件名搜索",modelValue:y.value,"onUpdate:modelValue":o[0]||(o[0]=u=>y.value=u),onKeyup:b(F,["enter"])},{suffix:h(()=>[l("i",{class:"iconfont icon-search",onClick:F})]),_:1},8,["modelValue"])]),l("div",{class:"iconfont icon-refresh",onClick:p}),m(B,{style:{"margin-left":"10px"},type:"danger",disabled:d.value.length==0,onClick:M},{default:h(()=>o[1]||(o[1]=[l("span",{class:"iconfont icon-del"},null,-1),z(" 批量删除 ")])),_:1},8,["disabled"])]),m(q,{ref_key:"navigationRef",ref:I,onNavChange:E,adminShow:!0},null,512)]),l("div",Y,[m(K,{columns:R,showPagination:!0,dataSource:v.value,fetch:p,initFetch:!1,options:V,onRowSelected:x},{fileName:h(({index:u,row:e})=>[l("div",{class:"file-item",onMouseenter:a=>U(e),onMouseleave:a=>D(e)},[(e.fileType==3||e.fileType==1)&&e.status==2?(s(),N(g,{key:0,cover:e.fileCover,width:32},null,8,["cover"])):(s(),i(L,{key:1},[e.folderType==0?(s(),N(g,{key:0,fileType:e.fileType},null,8,["fileType"])):n("",!0),e.folderType==1?(s(),N(g,{key:1,fileType:0})):n("",!0)],64)),e.showEdit?n("",!0):(s(),i("span",{key:2,class:"file-name",title:e.fileName},[l("span",{onClick:a=>$(e)},C(e.fileName),9,te),e.status==0?(s(),i("span",oe,"转码中")):n("",!0),e.status==1?(s(),i("span",le,"转码失败")):n("",!0)],8,ee)),e.showEdit?(s(),i("div",se,[m(T,{modelValue:e.fileNameReal,"onUpdate:modelValue":a=>e.fileNameReal=a,modelModifiers:{trim:!0},maxLength:190,onKeyup:b(a=>t.saveNameEdit(u),["enter"])},{suffix:h(()=>[z(C(e.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),l("span",{class:j(["iconfont icon-right1",e.fileNameReal?"":"not-allow"]),onClick:a=>t.saveNameEdit(u)},null,10,ae),l("span",{class:"iconfont icon-error",onClick:a=>t.cancelNameEdit(u)},null,8,ie)])):n("",!0),l("span",ne,[e.showOp&&e.fileId?(s(),i(L,{key:0},[e.folderType==0?(s(),i("span",{key:0,class:"iconfont icon-download",onClick:a=>P(e)},"下载",8,ce)):n("",!0),l("span",{class:"iconfont icon-del",onClick:a=>O(e)},"删除",8,re)],64)):n("",!0)])],40,Z)]),fileSize:h(({index:u,row:e})=>[e.fileSize?(s(),i("span",de,C(Q(c).Utils.size2Str(e.fileSize)),1)):n("",!0)]),_:1},8,["dataSource"])]),m(A,{ref_key:"previewRef",ref:S},null,512)])}}},Pe=G(pe,[["__scopeId","data-v-6816e480"]]);export{Pe as default};
